#!/bin/zsh
. common.shell

DEV=$1
[[ -e $DEV || -n $DEV ]] || DIE "Missing device: $DEV"

[[ $(id -u) != 0 ]] && DIE "I want to be root"

LOG "Create boot stick on $none$DEV"
LOG "Now create the partitions.$none   n p 1 (>50MB) a 1 t 1 83 w"
PAUSE "ok?"
fdisk $DEV

PART=1
LOG "Create filesystem on $none$DEV$PART"
PAUSE "ok?"
mkfs.ext2 $DEV$PART
e2label $DEV$PART corvix

LOG "Fake zip-fashion"
mkdiskimage -4 $DEV 0 64 32

SYSLINUX=syslinux
LOG "Make bootable."
$SYSLINUX -s $DEV$PART

IMG=./tmp/stickimage
[[ -d $IMG ]] || mkdir -p $IMG
LOG "Mount on $none$IMG"
mount $DEV$PART $IMG
mkdir -p $IMG/boot


