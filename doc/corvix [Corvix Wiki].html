<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    corvix    [Corvix Wiki]
  </title>

  <meta name="generator" content="DokuWiki Release 2009-12-25c &quot;Lemming&quot;" />
<meta name="robots" content="index,follow" />
<meta name="date" content="2010-08-25T15:11:44+0200" />
<meta name="keywords" content="corvix" />
<link rel="search" type="application/opensearchdescription+xml" href="/~wiki/lib/exe/opensearch.php" title="Corvix Wiki" />
<link rel="start" href="/~wiki/" />
<link rel="contents" href="/~wiki/doku.php?id=corvix&amp;do=index" title="Index" />
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="/~wiki/feed.php" />
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="/~wiki/feed.php?mode=list&amp;ns=" />
<link rel="alternate" type="text/html" title="Plain HTML" href="/~wiki/doku.php?do=export_xhtml&amp;id=corvix" />
<link rel="alternate" type="text/plain" title="Wiki Markup" href="/~wiki/doku.php?do=export_raw&amp;id=corvix" />
<link rel="canonical" href="http://merapi.physik.uni-kl.de/~wiki/doku.php?id=corvix" />
<link rel="stylesheet" media="all" type="text/css" href="/~wiki/lib/exe/css.php?s=all&amp;t=default&amp;tseed=1272878938" />
<link rel="stylesheet" media="screen" type="text/css" href="/~wiki/lib/exe/css.php?t=default&amp;tseed=1272878938" />
<link rel="stylesheet" media="print" type="text/css" href="/~wiki/lib/exe/css.php?s=print&amp;t=default&amp;tseed=1272878938" />
<script type="text/javascript" charset="utf-8" ><!--//--><![CDATA[//><!--
var NS='';var JSINFO = {"id":"corvix","namespace":""};
//--><!]]></script>
<script type="text/javascript" charset="utf-8" src="/~wiki/lib/exe/js.php?tseed=1272878938" ></script>

  <link rel="shortcut icon" href="/~wiki/lib/tpl/default/images/favicon.ico" />

  </head>

<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="pagename">
        [[<a href="/~wiki/doku.php?id=corvix&amp;do=backlink"  title="Backlinks">corvix</a>]]
      </div>
      <div class="logo">
        <a href="/~wiki/doku.php"  name="dokuwiki__top" id="dokuwiki__top" accesskey="h" title="[H]">Corvix Wiki</a>      </div>

      <div class="clearer"></div>
    </div>

    
    <div class="bar" id="bar__top">
      <div class="bar-left" id="bar__topleft">
        <form class="button btn_source" method="post" action="/~wiki/doku.php"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="corvix" /><input type="submit" value="Show pagesource" class="button" accesskey="v" title="Show pagesource [V]" /></div></form>        <form class="button btn_revs" method="get" action="/~wiki/doku.php"><div class="no"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="corvix" /><input type="submit" value="Old revisions" class="button" accesskey="o" title="Old revisions [O]" /></div></form>      </div>

      <div class="bar-right" id="bar__topright">
        <form class="button btn_recent" method="get" action="/~wiki/doku.php"><div class="no"><input type="hidden" name="do" value="recent" /><input type="hidden" name="id" value="corvix" /><input type="submit" value="Recent changes" class="button" accesskey="r" title="Recent changes [R]" /></div></form>        <form action="/~wiki/doku.php" accept-charset="utf-8" class="search" id="dw__search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>&nbsp;
      </div>

      <div class="clearer"></div>
    </div>

        <div class="breadcrumbs">
      <span class="bchead">Trace:</span> <span class="bcsep">&raquo;</span> <a href="/~wiki/doku.php?id=corvix_live"  class="breadcrumbs" title="corvix_live">corvix_live</a> <span class="bcsep">&raquo;</span> <span class="curid"><a href="/~wiki/doku.php?id=corvix"  class="breadcrumbs" title="corvix">corvix</a></span>          </div>
    
    
  </div>
  
  
  <div class="page">
    <!-- wikipage start -->
    <!-- TOC START -->
<div class="toc">
<div class="tocheader toctoggle" id="toc__header">Table of Contents</div>
<div id="toc__inside">

<ul class="toc">
<li class="level1"><div class="li"><span class="li"><a href="#what_is_corvix" class="toc">What is corvix?</a></span></div></li>
<li class="level1"><div class="li"><span class="li"><a href="#who_may_want_to_use_this" class="toc">Who may want to use this?</a></span></div></li>
<li class="level1"><div class="li"><span class="li"><a href="#introduction" class="toc">Introduction</a></span></div>
<ul class="toc">
<li class="level2"><div class="li"><span class="li"><a href="#motivation" class="toc">Motivation</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="#concept" class="toc">Concept</a></span></div></li>
</ul>
</li>
<li class="level1"><div class="li"><span class="li"><a href="#package_management" class="toc">Package Management</a></span></div>
<ul class="toc">
<li class="level2"><div class="li"><span class="li"><a href="#debian" class="toc">Debian</a></span></div>
<ul class="toc">
<li class="level3"><div class="li"><span class="li"><a href="#key_signatures" class="toc">Key signatures:</a></span></div></li>
</ul>
</li>
<li class="level2"><div class="li"><span class="li"><a href="#where_to_obtain_the_key_from" class="toc">Where to obtain the key from?</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="#components_availiable" class="toc">Components availiable</a></span></div></li>
</ul>
</li>
<li class="level1"><div class="li"><span class="li"><a href="#installation" class="toc">Installation</a></span></div>
<ul class="toc">
<li class="level2"><div class="li"><span class="li"><a href="#boot_image" class="toc">Boot image</a></span></div>
<ul class="toc">
<li class="level3"><div class="li"><span class="li"><a href="#creating_a_primary_bootimage" class="toc">Creating a primary bootimage</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#downloading_a_primary_bootimage" class="toc">Downloading a primary bootimage</a></span></div></li>
</ul>
</li>
<li class="level2"><div class="li"><span class="li"><a href="#booting" class="toc">Booting</a></span></div>
<ul class="toc">
<li class="level3"><div class="li"><span class="li"><a href="#boot_from_cd" class="toc">Boot from cd</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#boot_from_usb_stick" class="toc">Boot from usb stick</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#pxe_network_bootserver" class="toc">PXE Network Bootserver</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#arbitraty_debian_bootmedium" class="toc">Arbitraty Debian Bootmedium</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#use_existing_debian_installation" class="toc">Use existing debian installation</a></span></div></li>
</ul>
</li>
<li class="level2"><div class="li"><span class="li"><a href="#classes" class="toc">Classes</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="#booting_with_automatic_installation" class="toc">Booting with automatic installation</a></span></div></li>
</ul>
</li>
<li class="level1"><div class="li"><span class="li"><a href="#corvix_source_tree" class="toc">Corvix Source Tree</a></span></div>
<ul class="toc">
<li class="level2"><div class="li"><span class="li"><a href="#offical_releases" class="toc">Offical releases</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="#latest_snapshot" class="toc">Latest Snapshot</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="#git_repository" class="toc">GIT repository</a></span></div></li>
</ul>
</li>
<li class="level1"><div class="li"><span class="li"><a href="#building_a_high-performance_cluster" class="toc">Building a High-Performance Cluster</a></span></div>
<ul class="toc">
<li class="level2"><div class="li"><span class="li"><a href="#planning" class="toc">Planning</a></span></div>
<ul class="toc">
<li class="level3"><div class="li"><span class="li"><a href="#choosing_the_hardware" class="toc">Choosing the hardware</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#structural_layout" class="toc">Structural Layout</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#dual_gigabit_networking" class="toc">Dual Gigabit Networking</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#network_booting_diskless_clients" class="toc">Network booting diskless clients</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#hardware_installation" class="toc">Hardware Installation</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#software_installation" class="toc">Software Installation</a></span></div></li>
</ul>
</li>
<li class="level2"><div class="li"><span class="li"><a href="#configurations" class="toc">Configurations</a></span></div>
<ul class="toc">
<li class="level3"><div class="li"><span class="li"><a href="#passwords_ssh" class="toc">Passwords &amp; ssh</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#xen" class="toc">XEN</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#nfs" class="toc">NFS</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#mirror" class="toc">Mirror</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#login_server" class="toc">Login server</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#dns_server" class="toc">DNS Server</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#clients" class="toc">Clients</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#server" class="toc">Server</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#client2" class="toc">Client</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#qos" class="toc">QOS</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#reservations" class="toc">Reservations</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#temp_directory" class="toc">Temp directory</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#ssh_server" class="toc">SSH server</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#pxe_bootserver" class="toc">PXE Bootserver</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#admin_computer_image" class="toc">Admin Computer Image</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#apache2_webserver" class="toc">Apache2 Webserver</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#logserver" class="toc">Logserver</a></span></div></li>
</ul>
</li>
<li class="level2"><div class="li"><span class="li"><a href="#further_software" class="toc">Further Software</a></span></div>
<ul class="toc">
<li class="level3"><div class="li"><span class="li"><a href="#ganglia" class="toc">Ganglia</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="#rgang" class="toc">Rgang</a></span></div></li>
</ul>
</li>
<li class="level2"><div class="li"><span class="li"><a href="#install_new_node" class="toc">Install new Node</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="#booting_the_cluster" class="toc">Booting the cluster</a></span></div></li>
</ul>
</li>
<li class="level1"><div class="li"><span class="li"><a href="#corvix_live" class="toc">Corvix live</a></span></div></li>
<li class="level1"><div class="li"><span class="li"><a href="#legal_stuff" class="toc">Legal Stuff</a></span></div></li></ul>
</div>
</div>
<!-- TOC END -->

<p>
Welcome to the webpage of the corvix distribution.
</p>

<p>
Current status: We are merging our working installation into a reproduceable framework. This project is under heavy development and not yet working for the end-user. Nevertheless you already may check out our source tree or add the repositories to your current debian installation. 
</p>

<p>
<code>&#039;Warning: This is a fully automatic installation, which will wipe your hdds!</code>&#039;
</p>



<h1><a name="what_is_corvix" id="what_is_corvix">What is corvix?</a></h1>
<div class="level1">

<p>
Corvus corvax likes to steal; this distribution steals ideas :) It steals ideas in a positive way - we contribute a set of script, which you may use to build up your own high-performance cluster without the need to search for all the packages / documentation yourself. This distribution is the result of the lessons learned by building up a 180+ CPU Linux cluster with several NFS servers from scratch.
In fact corvix is less a distribution and more a cheat sheet for installing debian in a scientific environment. After you install the corvix distribution, you have a debian with additional features.
Corvix GNU/Linux provides preconfigured profiles for both workstations (i.e. your laptop) and complete clusters. Nevertheless: If you expect a colorful eyecandy system… forget it. Corvix is an advanced distribution; or call it a dirty hack… It works for us ;)
</p>

</div>

<h1><a name="who_may_want_to_use_this" id="who_may_want_to_use_this">Who may want to use this?</a></h1>
<div class="level1">

<p>
Nobody, except us! If you nevertheless want to use it, feel free to do so without any kind of warranty. 
</p>

</div>

<h1><a name="introduction" id="introduction">Introduction</a></h1>
<div class="level1">

<p>
Probably you want to read this first, before you decide to try out our stuff. 
</p>

</div>

<h2><a name="motivation" id="motivation">Motivation</a></h2>
<div class="level2">

<p>
Usually in a scientific environment one likes to have a stable base system (this also could be FreeBSD) and then only update a couple of really important packages to the bleeding edge. Here, debian is chosen as the basis system. The corvix distribution will install a straight debian/etch with a set of common packages selected.
Any additional software will be compiled from scratch using a portrage (Gentoo) alike system called egatrop. 
</p>

</div>

<h2><a name="concept" id="concept">Concept</a></h2>
<div class="level2">

<p>
The main concept is: console rocks.
There is no further documentation, than this file (which is included in the distribution). For any changes / configuration you may want to do: <acronym title="Read The Fine Manual">RTFM</acronym>.
</p>
<ul>
<li class="level1"><div class="li"> advanced user</div>
</li>
<li class="level1"><div class="li"> textmode</div>
</li>
<li class="level1"><div class="li"> full (?) documentation: download git source tree, and read</div>
</li>
</ul>

<p>

  /doc
</p>

</div>

<h1><a name="package_management" id="package_management">Package Management</a></h1>
<div class="level1">

</div>

<h2><a name="debian" id="debian">Debian</a></h2>
<div class="level2">

<p>
For the stable packages we rely completely on the Debian GNU/Linux distribution. If you want to use our stuff, you have to put the components in your /etc/apt/sources.list to use our repositories. So far we have only a testing distribution (in terms of debians vocabulary); once we have one complete framework, we will provide this as the stable distribution.
</p>

</div>

<h3><a name="key_signatures" id="key_signatures">Key signatures:</a></h3>
<div class="level3">

<p>
We use secure apt. So use our public key to make sure, you apt-get no black-hat stuff. 
This is the key: 974E7D68 [<a href="http://pgpkeys.pca.dfn.de/pks/lookup?op=get&amp;search=0x37A46DF5974E7D68" class="urlextern" title="http://pgpkeys.pca.dfn.de/pks/lookup?op=get&amp;search=0x37A46DF5974E7D68"  rel="nofollow">http://pgpkeys.pca.dfn.de/pks/lookup?op=get&amp;search=0x37A46DF5974E7D68</a>] or here [<a href="http://corvix.eu/key/corvix.txt" class="urlextern" title="http://corvix.eu/key/corvix.txt"  rel="nofollow">http://corvix.eu/key/corvix.txt</a>] 
with some details [<a href="http://pgpkeys.pca.dfn.de/pks/lookup?op=vindex&amp;search=0x37A46DF5974E7D68&amp;fingerprint=on" class="urlextern" title="http://pgpkeys.pca.dfn.de/pks/lookup?op=vindex&amp;search=0x37A46DF5974E7D68&amp;fingerprint=on"  rel="nofollow">http://pgpkeys.pca.dfn.de/pks/lookup?op=vindex&amp;search=0x37A46DF5974E7D68&amp;fingerprint=on</a>] and the fingerprint 
 <code>0189 4F9A 5CFD 0242 5BEA 39E6 37A4 6DF5 974E 7D68</code>.
</p>

</div>

<h2><a name="where_to_obtain_the_key_from" id="where_to_obtain_the_key_from">Where to obtain the key from?</a></h2>
<div class="level2">

<p>
1. from keyserver
</p>
<pre class="code">gpg --keyserver pgpkeys.mit.edu --recv-key 974E7D68
gpg -a --export 974E7D68 | sudo apt-key add -</pre>

<p>
2. from keyring
</p>
<pre class="code">apt-get -y --force-yes install corvix-keyring</pre>

<p>
<code>&#039;TODO: Move all stuff to one component, so desktop can be installed without awsome component etc</code>&#039;
</p>

</div>

<h2><a name="components_availiable" id="components_availiable">Components availiable</a></h2>
<div class="level2">

<p>

{| border=“1”
! Component
! Directory
! Comment 
</p>
<table class="inline">
	<tr class="row0">
		
	</tr>
	<tr class="row1">
		
	</tr>
	<tr class="row2">
		
	</tr>
	<tr class="row3">
		
	</tr>
	<tr class="row4">
		
	</tr>
	<tr class="row5">
		
	</tr>
	<tr class="row6">
		
	</tr>
	<tr class="row7">
		
	</tr>
	<tr class="row8">
		
	</tr>
</table>
<table class="inline">
	<tr class="row0">
		
	</tr>
</table>

</div>

<h1><a name="installation" id="installation">Installation</a></h1>
<div class="level1">

</div>

<h2><a name="boot_image" id="boot_image">Boot image</a></h2>
<div class="level2">

</div>

<h3><a name="creating_a_primary_bootimage" id="creating_a_primary_bootimage">Creating a primary bootimage</a></h3>
<div class="level3">

<p>
The easiest way is to start from a debian system. Check out our <span class="curid"><a href="/~wiki/doku.php?id=corvix#corvix_source_tree" class="wikilink1" title="corvix">Source tree</a></span> and then create the bootimage in:

</p>
<pre class="code">cd var/install
./build</pre>

<p>

<code>&#039;(zsh is required to build this package, but even after installing zsh I still get an error)</code>&#039;
</p>
<pre class="code">Resolving www.kernel.org... 130.239.17.4, 199.6.1.164
Connecting to www.kernel.org|130.239.17.4|:80... connected.
HTTP request sent, awaiting response... 404 Not Found
2009-08-04 11:24:15 ERROR 404: Not Found.
cp: cannot stat `/corvix/var/install//tmp/syslinux-3.70/core/isolinux.bin&#039;: No such file or directory
Make pxelinux image
cp: cannot stat `/corvix/var/install//tmp/syslinux-3.70/core/pxelinux.0&#039;: No such file or directory</pre>

<p>

<code>&#039; The files are located at [<a href="http://www.pt.kernel.org/pub/linux/boot/syslinux/Old/" class="urlextern" title="http://www.pt.kernel.org/pub/linux/boot/syslinux/Old/"  rel="nofollow">http://www.pt.kernel.org/pub/linux/boot/syslinux/Old/</a> Kernel.org], I downloaded the kernel and extracted it manually. Next error: mkisofs was not installed. </code>&#039;
</p>

</div>

<h4><a name="testing_the_bootimage" id="testing_the_bootimage">Testing the bootimage</a></h4>
<div class="level4">

<p>
Once created you may test it using qemu. At first create an empty disk image
</p>
<pre class="code">qemu-img create -f qcow ./corvix.qcow 10G</pre>

<p>
Fire up qemu:
</p>
<pre class="code">qemu -cdrom boot/corvix.iso -hda corvix.qcow</pre>

<p>
<code>&#039;maybe explain more detailed where the image is located and which user rights are required for which task.</code>&#039;
</p>
<pre class="code">var/install/boot/corvix.iso</pre>

</div>

<h3><a name="downloading_a_primary_bootimage" id="downloading_a_primary_bootimage">Downloading a primary bootimage</a></h3>
<div class="level3">

<p>
You may also download a current corvix.iso.
</p>

</div>

<h2><a name="booting" id="booting">Booting</a></h2>
<div class="level2">

</div>

<h3><a name="boot_from_cd" id="boot_from_cd">Boot from cd</a></h3>
<div class="level3">

<p>
Burn the corvix.iso to cd :)

</p>

</div>

<h3><a name="boot_from_usb_stick" id="boot_from_usb_stick">Boot from usb stick</a></h3>
<div class="level3">

<p>
Create a bootable stick:
</p>
<pre class="code">makebootstick /dev/YOURUSBDEVICE1234</pre>

<p>
If you specify a partition (i.e. /dev/sdg2) the script will install the stuff in this partition on the stick. And if you execute it with a whole disk (i.e. /dev/sdg) it will also create a patition layout on the stick.
<code>&#039;TODO</code>&#039;does this work?
</p>

</div>

<h3><a name="pxe_network_bootserver" id="pxe_network_bootserver">PXE Network Bootserver</a></h3>
<div class="level3">

<p>
<code>&#039;TODO</code>&#039;@Jan Merge with pxe section below.
</p>

<p>

You need to have software:
</p>
<pre class="code">apt-get install dhcp3-server tftpd-hpa xinetd</pre>

<p>
Insert some stuff in your /etc/dhcp3/dhcpd.conf
</p>
<pre class="code">...
allow booting;
allow bootp;
filename &quot;pxelinux.0&quot;;
...</pre>

<p>
Configure xinetd <code>&#039;(the file has to be created, maybe we can offer it as an download as well)</code>&#039;
</p>
<pre class="code"># /etc/xinetd.d/tftp
service tftp
{
   protocol        = udp
   port            = 69
   socket_type     = dgram
   wait            = yes
   user            = root
   group           = root
   server          = /usr/sbin/in.tftpd 
   server_args = -s /var/lib/tftpboot/
   disable         = no
}</pre>

<p>

Restart xinetd and copy the files
</p>
<pre class="code">cp isoimage/* -rv /var/lib/tftpboot
chmod -R aog+rx /var/lib/tftpboot</pre>

<p>

ALternative: 
Instead of installing xinetd it is also possible to activate tftp by default, edit: /etc/default/tftpd-hpa 
</p>
<pre class="code">#Defaults for tftpd-hpa
RUN_DAEMON=&quot;yes&quot;
OPTIONS=&quot;-l -s /var/lib/tftpboot&quot;</pre>

</div>

<h3><a name="arbitraty_debian_bootmedium" id="arbitraty_debian_bootmedium">Arbitraty Debian Bootmedium</a></h3>
<div class="level3">

<p>
Just wait for the bootprompt and then type
</p>
<pre class="code">boot: auto url=corvix.eu </pre>

<p>
You may load classes:
</p>
<pre class="code">boot: auto url=corvix.eu classes=desktop</pre>

</div>

<h3><a name="use_existing_debian_installation" id="use_existing_debian_installation">Use existing debian installation</a></h3>
<div class="level3">

<p>
And add the repositories ;)
</p>

</div>

<h2><a name="classes" id="classes">Classes</a></h2>
<div class="level2">

<p>
Can be found on the webserver on d-i
[<a href="http://merapi.physik.uni-kl.de/~corvix/d-i/classes/" class="urlextern" title="http://merapi.physik.uni-kl.de/~corvix/d-i/classes/"  rel="nofollow">http://merapi.physik.uni-kl.de/~corvix/d-i/classes/</a>]
</p>

<p>
Source: [<a href="http://www.hands.com/d-i/" class="urlextern" title="http://www.hands.com/d-i/"  rel="nofollow">http://www.hands.com/d-i/</a>]
</p>

</div>

<h2><a name="booting_with_automatic_installation" id="booting_with_automatic_installation">Booting with automatic installation</a></h2>
<div class="level2">

<p>
<code>&#039;TODO</code>&#039;@Jan: plz test &amp; learn this stuff :)
</p>

<p>
This is the outline for the installation procedure
</p>
<ul>
<li class="level1"><div class="li"> unknown MAC ⇒ boot rescue system (from debian boot image) with: netword &amp; ssh</div>
</li>
<li class="level1"><div class="li"> on server: dhcp knows the new mac/ip ⇒ use it for starting the installation:</div>
</li>
<li class="level1"><div class="li"> install_node (script)</div>
</li>
</ul>
<ol>
<li class="level1"><div class="li"> display the new mac adresses with timestamp (for selecting the right pc)</div>
</li>
<li class="level1"><div class="li"> select right mac adress</div>
</li>
<li class="level1"><div class="li"> select profile for installation</div>
</li>
<li class="level1"><div class="li"> use arping to determine the corresponding ip address</div>
</li>
<li class="level1"><div class="li"> put mac address in dhcpd.conf in the installation section  (q: how can we select the profile from dhcpd.conf?)</div>
</li>
<li class="level1"><div class="li"> ssh ip reboot to start installation</div>
</li>
</ol>

</div>

<h1><a name="corvix_source_tree" id="corvix_source_tree">Corvix Source Tree</a></h1>
<div class="level1">

</div>

<h2><a name="offical_releases" id="offical_releases">Offical releases</a></h2>
<div class="level2">

<p>
Full source tree of an official release.
(none yet)

</p>

</div>

<h2><a name="latest_snapshot" id="latest_snapshot">Latest Snapshot</a></h2>
<div class="level2">

<p>
There is no current stable version.
</p>

</div>

<h2><a name="git_repository" id="git_repository">GIT repository</a></h2>
<div class="level2">
<pre class="code">git clone git://git.corvix.eu/corvix.git</pre>

<p>
The repositories are hosted on repo.or.cz. <code>&#039;the information I was looking for ! maybe rearrange it</code>&#039;
</p>

<p>
<code>&#039;Q</code>&#039;@Jan: Should we setup a git server?
</p>

</div>

<h1><a name="building_a_high-performance_cluster" id="building_a_high-performance_cluster">Building a High-Performance Cluster</a></h1>
<div class="level1">

</div>

<h2><a name="planning" id="planning">Planning</a></h2>
<div class="level2">

</div>

<h3><a name="choosing_the_hardware" id="choosing_the_hardware">Choosing the hardware</a></h3>
<div class="level3">

<p>
In our case we want to run molecular dynamic dimulations; these systems are coupled loosely and if we choose a good partition (which holds for any task, of course), we can use cheap hardware to build our cluster.
Most computers avaliable today have two gigabit ports. As low-latency networking is still much more costly (~same cost, as one additional node), we choose to maximize the number of nodes instead. So our choice is dual-gigabit networking.
Another thing to consider is accessibility of the nodes. For a very small number of nodes, it is not necessary to have them mounted in a rack. There are very comfortable choices for terminal access (remote BIOS, KVM swichtes etc). We go the hard way, drop the costs per node again and have only one screen and one keyboard to plug in; more was never needed yet. Once the node tries to boot from hdd with pxeboot fallback, there is no need for terminal access any more. And everything else will be done via remote access (why should one want to stay in the loud server room?). 
</p>

</div>

<h3><a name="structural_layout" id="structural_layout">Structural Layout</a></h3>
<div class="level3">

<p>
We choose the following setup for the server overhead. Firstly we have a head server, which will provide dhcp, dns, a debian mirror, nis, ganglia and the queue. Furthermore this is the node, where the administrative stuff is done. It has two gigabit connections to inside and one connection to outside.
Two identical login nodes provide user access; each has only one gigabit connection to inside and one to outside.
A sum of three nas stations with hard-/software raid provide space. Each of them is connected with two gigabit ports to the inside.
</p>

</div>

<h3><a name="dual_gigabit_networking" id="dual_gigabit_networking">Dual Gigabit Networking</a></h3>
<div class="level3">

<p>
All nodes have two gigabit connections to inside. Each of them is connected in a different network. These two different networks will decrease the network load. The dual gigabit network is used in modulo2 mode. Every 2nd node will go through the 2nd network to the nas stations; this way we circumvene the bottleneck at the nas without loosing latency through channel bonding.
We can drop the costs even further by not using stackable switches. The only relevant drawback will be, that one cannot use all nodes at once for one big task any more. By configuring the partitions of nodes in the queue performance loss can be prevented.
Our cluster uses two 48 port and two 24 port switches. Both are linked, because the servers then only once have to inject into each network. Two sets of nodes are now defined: one for fast i/o to the nas stations and one for slow (link-bottleneck) i/o.
</p>

</div>

<h3><a name="network_booting_diskless_clients" id="network_booting_diskless_clients">Network booting diskless clients</a></h3>
<div class="level3">

<p>
It may sound nice to have a complete root-over-nfs system booted via pxe. But the documentation avaliable is very poor. Besides you may observe serious performance problems in booting more then ten nodes at ones and even worse in running state.
Our conclusion is here: Use pxeboot to install the nodes automatically. A small local hdd can also serve as local scratch for fast i/o.
</p>

</div>

<h3><a name="hardware_installation" id="hardware_installation">Hardware Installation</a></h3>
<div class="level3">

<p>
Briefly we summarize some lessons learned. If you choose to use different networks: use different colors (we didn&#039;t). As with number of particles entropy will increase dramatically, use cable straps and try to fix them at the rack asap. As hdds tend to break notoriously consider using telescope mounts in a rack. It&#039;s also very useful to have spare hdds at hand.
</p>

</div>

<h3><a name="software_installation" id="software_installation">Software Installation</a></h3>
<div class="level3">

<p>
We have chosen debian, because we thought it is the most stable distribution and easy to maintain. After all it doesn&#039;t matter at all, what distribution you choose; all new nodes will be installed from a golden node image using tar.
Following the saying If it ain&#039;t broke, don&#039;t fix it: Our policy is to not change anything after primary installation. In particular: don&#039;t update the distribution. We kept a snapshot mirror of our distribution on the head server for future software installation.
From security point of view we have a locked rack with a trusted lan, so security doesn&#039;t matter there. The login nodes have outwards connection and have the recent security updates out course.
All important configuration files can be found in corvix. As in such a cluster much stuff is done hardware specifically we can only provide the important (portable) configuration files.
</p>

</div>

<h2><a name="configurations" id="configurations">Configurations</a></h2>
<div class="level2">

</div>

<h3><a name="passwords_ssh" id="passwords_ssh">Passwords &amp; ssh</a></h3>
<div class="level3">

<p>
The root password ist <code>root</code>.

</p>
<ul>
<li class="level1"><div class="li"> Administration of ssh servers <a href="/~wiki/doku.php?id=ssh_security" class="wikilink1" title="ssh_security">ssh_security</a></div>
</li>
</ul>

</div>

<h3><a name="xen" id="xen">XEN</a></h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Obskure Fehlermeldungen, wegen Modulen ⇒ installiere Kernelmodule für geladenen Kernel im Guest</div>
</li>
</ul>

</div>

<h3><a name="nfs" id="nfs">NFS</a></h3>
<div class="level3">
<pre class="code">apt-get install nfs-kernel-server</pre>

</div>

<h4><a name="client" id="client">Client</a></h4>
<div class="level4">
<pre class="code">apt-get install  nfs-common </pre>
<pre class="code">#/etc/fstab
nas1:/mnt/vol1 /mnt/nas1 nfs defaults,noauto,exec 0 0
nas2:/mnt/vol1 /mnt/nas2 nfs defaults,noauto,exec 0 0
nas3:/mnt/vol1 /mnt/nas3 nfs defaults,noauto,exec 0 0
nas4:/mnt/vol1 /mnt/nas4 nfs defaults,noauto,exec 0 0
nas5:/mnt/vol1 /mnt/nas5 nfs defaults,noauto,exec 0 0</pre>

</div>

<h3><a name="mirror" id="mirror">Mirror</a></h3>
<div class="level3">

<p>
Installation of the mirror server

</p>
<pre class="code">apt-get install apt-mirror</pre>
<pre class="code">#/etc/apt/mirror.list
deb http://ftp.uni-kl.de/debian/ lenny main contrib non-free main/debian-installer
deb-amd64 http://ftp.uni-kl.de/debian/ lenny main contrib non-free main/debian-installer
deb-src http://ftp.uni-kl.de/debian/ lenny main contrib   non-free
deb http://security.debian.org/ lenny/updates main contrib non-free
deb-amd64 http://security.debian.org/ lenny/updates main contrib non-free
deb-src http://security.debian.org/ lenny/updates main contrib non-free
deb ftp://debian.netcologne.de/debian-multimedia.org lenny main
deb-amd64 ftp://debian.netcologne.de/debian-multimedia.org lenny main
deb-src ftp://debian.netcologne.de/debian-multimedia.org lenny main

apt-mirror

apt-get install apache2
ln -s /var/spool/apt-mirror/mirror/ftp.uni-kl.de/debian/ /var/www/debian
ln -s /var/spool/apt-mirror/mirror/debian.netcologne.de/debian-multimedia.org/  /var/www/debian-multimedia.org
ln -s /var/spool/apt-mirror/mirror/security.debian.org/ /var/www/security.debian.org</pre>

</div>

<h4><a name="client1" id="client1">Client</a></h4>
<div class="level4">
<pre class="code">#/etc/apt/sources.list
deb http://mirror/debian/ lenny main contrib non-free
deb-src http://mirror/debian/ lenny main contrib non-free

deb http://mirror/security.debian.org/ lenny/updates main contrib
deb-src http://mirror/security.debian.org/ lenny/updates main contrib

deb http://mirror/debian-multimedia.org lenny main
deb-src http://mirror/debian-multimedia.org lenny main</pre>

<p>

Fix this: We also have to insert the corvix mirror!
</p>
<pre class="code">deb http://corvix.eu testing meta ware</pre>

<p>
<code>&#039;Fehlermeldung:</code>&#039;
W: GPG error: <a href="http://mirror" class="urlextern" title="http://mirror"  rel="nofollow">http://mirror</a> lenny Release: The following signatures couldn&#039;t be verified because the public key is not available: NO_PUBKEY 07DC563D1F41B907
W: You may want to run apt-get update to correct these problems
</p>

<p>
Solution
</p>
<pre class="code">gpg --armor --export 07DC563D1F41B907 | apt-key add -</pre>

</div>

<h3><a name="login_server" id="login_server">Login server</a></h3>
<div class="level3">

<p>
 apt-get install corvix-edit corvix-coding corvix-sci corvix queue-client queue-utils nis-client nfs-common
</p>

</div>

<h4><a name="dhcp_dns" id="dhcp_dns">DHCP &amp; DNS</a></h4>
<div class="level4">

<p>
Our dhcp server supports pxeboot and provides hostnames to the known nodes. Because we don&#039;t want to have redundant configurations, other configurations can be created automatically from the dhcpd.conf.
Install using 
 apt-get install dhcp3-server update-dns
</p>

<p>
and set it up with you custom configuration. This is how a configuration could look alike 
</p>
<pre class="code">#/etc/dhcp3/dhcpd.conf
allow booting;
allow bootp; 
 
server-identifier earth.physik.uni-kl.de;
option domain-name &quot;earth.physik.uni-kl.de&quot;;
authoritative;

option ntp-servers ntp.rhrk.uni-kl.de;

subnet 10.1.0.0 netmask 255.255.255.0 {
       range 10.1.0.200 10.1.0.240;
       filename &quot;pxelinux.0&quot;;
}
  
group  {
       host s1 { hardware ethernet 00:30:1b:47:df:c9; fixed-address 10.1.0.101; }
       host s2 { hardware ethernet 00:30:1b:47:18:e6; fixed-address 10.1.0.102; }
       host s3 { hardware ethernet 00:30:1b:47:a6:d5; fixed-address 10.1.0.103; }
       host s4 { hardware ethernet 00:30:1b:47:f0:4e; fixed-address 10.1.0.104; }
       host s5 { hardware ethernet 00:30:1b:47:d6:04; fixed-address 10.1.0.105; }
       host s6 { hardware ethernet 00:30:1b:47:dd:33; fixed-address 10.1.0.106; }
       host s7 { hardware ethernet 00:30:1b:47:84:18; fixed-address 10.1.0.107; }
       host s8 { hardware ethernet 00:30:1b:47:16:54; fixed-address 10.1.0.108; }
       host s9 { hardware ethernet 00:30:1b:47:ef:2e; fixed-address 10.1.0.109; }
       host s10 { hardware ethernet 00:30:1b:47:17:6a; fixed-address 10.1.0.110; if substring (option vendor-class-identifier, 0, 3) = &quot;d-i&quot; {    filename &quot;http://host/preseed/profile_abc.cfg&quot;; }
 
}
option routers 10.1.0.254;
option broadcast-address 10.1.0.255;   

option domain-name-servers 10.1.0.254, 131.246.1.116, 131.246.9.116;

one-lease-per-client on;
default-lease-time 31104000;
max-lease-time 31104000;
use-host-decl-names on;
 
option ip-forwarding on;</pre>

<p>
In particular it is important, that the host entries look like mentioned above. Anyway else the dependent scripts will not work.
</p>

</div>

<h3><a name="dns_server" id="dns_server">DNS Server</a></h3>
<div class="level3">

<p>
A pragmatic solution is dnsmasq. Using the syntax above the tool
 update-dns
will provide a new /etc/hosts file and restart the dnsmasq server.
</p>

</div>

<h4><a name="nis" id="nis">NIS</a></h4>
<div class="level4">

<p>
These packages will install the nis software and modify the files <code>passwd</code>, <code>group</code> and  <code>nsswitch.conf</code> in <code>/etc</code> for the use with nis.
The <code>defaultdomain</code> is <code>cluster</code>.
</p>

<p>
 apt-get install nis-server
</p>

<p>
Fix this:
 chown -R root:root /etc
</p>

<p>
Afterwards setup further:
 cd /var/yp
 make
 /etc/init.d/nis restart
 /usr/lib/yp/ypinit -m
</p>

</div>

<h3><a name="clients" id="clients">Clients</a></h3>
<div class="level3">

<p>
This will apply to all nodes, login servers etc. Install it using
 apt-get install nis-client
</p>

</div>

<h4><a name="firewall" id="firewall">Firewall</a></h4>
<div class="level4">

<p>
You may want to make them a little bit more secure. Usually you want to have one gateway which may also do port forwarding for ssh to the actual login nodes. For this we use the firehol package.
</p>

<p>
 apt-get install firehol
</p>

<p>
This is a sample configuration:
</p>

<p>
 #/etc/firehol/firehol.conf
 version 5
</p>

<p>
 #forward ssh connections
 dnat to 10.1.100.1:22 inface eth1 proto tcp dport 1234
</p>

<p>
 # secure world interface
 interface eth0 internet
</p>
<pre class="code">  protection strong 10/sec 10
  client all accept
  server ssh accept
  server cups accept src &quot;131.246.236.1/28&quot;</pre>

<p>

 # insecure internal interface
 interface eth1 internal
</p>
<pre class="code">  server all accept
  client all accept</pre>

<p>

 # be a router
 router home2internet inface eth1 outface eth0
</p>
<pre class="code">  route all accept
  masquerade</pre>

<p>

 router internet2home inface eth0 outface eth1
</p>
<pre class="code">  masquerade reverse
  client all  accept
  server ident   reject with tcp-reset</pre>

</div>

<h4><a name="queue_system" id="queue_system">Queue system</a></h4>
<div class="level4">

<p>
Current status: its best to compile it yourself. The sources can be found on: on admin.cluster: /usr/src torque-2.4.2.tar.gz and maui-3.2.6p21.tar.gz. Compilation of torque:
 ./configure –with-default-server=queue –with-server-home=/var/spool/torque –with-rcp=scp; make ;make install; ldconfig
Compilation of maui:
 ./configure –with-pbs –with-spooldir=/var/spool/torque –with-key=666; make ;make install; ldconfig
</p>

<p>
<code>&#039;Below comes the outdated stuff. The packages are broken in the current version!!</code>&#039;

</p>

</div>

<h3><a name="server" id="server">Server</a></h3>
<div class="level3">

<p>
 apt-get install torque maui queue-server queue-utils
</p>

<p>
This should be fixed…
 chown -R root:root /var/spool/torque
</p>

</div>

<h3><a name="client2" id="client2">Client</a></h3>
<div class="level3">

<p>
 apt-get install queue-client queue-utils
</p>

<p>
If it&#039;s a computation node: Add node to the server configuration. So on the queueserver:
* add node to /var/spool/torque/server_priv/nodes
* add node to /var/spool/torque/maui.cfg
</p>

</div>

<h3><a name="qos" id="qos">QOS</a></h3>
<div class="level3">

<p>
<code>&#039;todo</code>&#039;:@gz: test
Example:
</p>

<p>
 QOSCFG[mercury] PRIORITY=1000 QFLAGS=PREEMPTOR  
 HOSTLIST=herc[0001-00038]:pomp[0001-0030]:olympus:vesuvius
</p>

<p>
 GROUPCFG[rhodes]    	PRIORITY=1000 QLIST=mercury QDEF=mercury
</p>

<p>
 CLASSCFG[altix]		QLIST=qm QDEF=qm MAXIJOB=4
 CLASSCFG[mercury]	PRIORITY=1000 QLIST=md:qm:mercury QDEF=mercury  
 MAXIJOB=4
</p>

<p>
Notice they are using the Altix queue/class even though they are a  
mercury group using the mercury QOS. Anyhow, hope this helps….
</p>

</div>

<h3><a name="reservations" id="reservations">Reservations</a></h3>
<div class="level3">

<p>
<code>&#039;TODO</code>&#039;@gz: test
<a href="/~wiki/doku.php?id=standing_reservations" class="wikilink1" title="standing_reservations">Standing Reservations</a>
</p>

<p>
Administration: [<a href="http://www.clusterresources.com/products/maui/docs/7.1.5managingreservations.shtml" class="urlextern" title="http://www.clusterresources.com/products/maui/docs/7.1.5managingreservations.shtml"  rel="nofollow">http://www.clusterresources.com/products/maui/docs/7.1.5managingreservations.shtml</a> Configuration], [<a href="http://www.clusterresources.com/products/maui/docs/7.1.4reservationpolicies.shtml" class="urlextern" title="http://www.clusterresources.com/products/maui/docs/7.1.4reservationpolicies.shtml"  rel="nofollow">http://www.clusterresources.com/products/maui/docs/7.1.4reservationpolicies.shtml</a> Policies]
</p>

</div>

<h3><a name="temp_directory" id="temp_directory">Temp directory</a></h3>
<div class="level3">

<p>
<code>&#039;TODO</code>&#039;@gz: implement and test
</p>
<pre class="code">prologue

#!/bin/sh
# Create TMPDIR on all the nodes
# Copyright 1999, 2000, 2001 Ohio Supercomputer Center
# prologue gets 3 arguments:
# 1 -- jobid
# 2 -- userid
# 3 -- grpid
#
jobid=$1
user=$2
group=$3
nodefile=/var/spool/pbs/aux/$jobid
if [ -r $nodefile ] ; then
    nodes=$(sort $nodefile | uniq)
else
    nodes=localhost
fi
tmp=/tmp/pbstmp.$jobid
for i in $nodes ; do
    ssh $i mkdir -m 700 $tmp \&amp;\&amp; chown $user.$group $tmp
done
exit 0</pre>
<pre class="code">epilogue 
 
#!/bin/sh
# Clear out TMPDIR
# Copyright 1999, 2000, 2001 Ohio Supercomputer Center
# epilogue gets 9 arguments:
# 1 -- jobid 
# 2 -- userid
# 3 -- grpid
# 4 -- job name
# 5 -- sessionid
# 6 -- resource limits
# 7 -- resources used
# 8 -- queue
# 9 -- account
#
jobid=$1
nodefile=/var/spool/pbs/aux/$jobid
if [ -r $nodefile ] ; then
    nodes=$(sort $nodefile | uniq)
else
    nodes=localhost
fi
tmp=/tmp/pbstmp.$jobid
for i in $nodes ; do
    ssh $i rm -rf $tmp
done
exit 0  </pre>

<p>

[<a href="http://www.clusterresources.com/torquedocs21/a.gprologueepilogue.shtml" class="urlextern" title="http://www.clusterresources.com/torquedocs21/a.gprologueepilogue.shtml"  rel="nofollow">http://www.clusterresources.com/torquedocs21/a.gprologueepilogue.shtml</a>]
</p>

</div>

<h3><a name="ssh_server" id="ssh_server">SSH server</a></h3>
<div class="level3">

<p>
We use hostbased authentification inside the cluster and public key authentification outside.

</p>

</div>

<h3><a name="pxe_bootserver" id="pxe_bootserver">PXE Bootserver</a></h3>
<div class="level3">
<pre class="code">apt-get install  tftpd-hpa xinetd</pre>

<p>
Create xinetd service

</p>
<pre class="code"># /etc/xinetd.d/tftp
service tftp
{
   protocol        = udp
   port            = 69
   socket_type     = dgram
   wait            = yes
   user            = root
   group           = root
   server          = /usr/sbin/in.tftpd 
   server_args = -s /var/lib/tftpboot/
   disable         = no
}</pre>
<pre class="code">apt-get install git-core
cd /usr/src</pre>

<p>
⇒ clone the git repo of corvix
</p>
<pre class="code">apt-get install mkisofs</pre>

<p>
⇒ build the image and copy it to pxe dir
</p>

</div>

<h4><a name="old_stuff" id="old_stuff">Old stuff</a></h4>
<div class="level4">

<p>

Using the linux pxeboot, the head server provides debian network install and a custom install script for adding new nodes in under 4 minutes automatically.
</p>

<p>
<code>&#039;TODO</code>&#039;@Jan: howto setup pxe - plz document
</p>

<p>
Further links for the preseed configuration: 
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://d-i.alioth.debian.org/manual/en.i386/index.html" class="urlextern" title="http://d-i.alioth.debian.org/manual/en.i386/index.html"  rel="nofollow">http://d-i.alioth.debian.org/manual/en.i386/index.html</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://hands.com/d-i/" class="urlextern" title="http://hands.com/d-i/"  rel="nofollow">http://hands.com/d-i/</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.debian.org/DebianInstaller/Preseed" class="urlextern" title="http://wiki.debian.org/DebianInstaller/Preseed"  rel="nofollow">http://wiki.debian.org/DebianInstaller/Preseed</a></div>
</li>
</ul>

</div>

<h3><a name="admin_computer_image" id="admin_computer_image">Admin Computer Image</a></h3>
<div class="level3">
<pre class="code">apt-get install rgang</pre>

</div>

<h3><a name="apache2_webserver" id="apache2_webserver">Apache2 Webserver</a></h3>
<div class="level3">

<p>
<a href="/~wiki/doku.php?id=apache2_webserver" class="wikilink1" title="apache2_webserver">Apache2 Webserver</a>
</p>

</div>

<h3><a name="logserver" id="logserver">Logserver</a></h3>
<div class="level3">

<p>
To make it easier to monitor the cluster we decided to setup an syslogd log server. On the Log server in /etc/default/rsyslog (/etc/default/syslogd.conf) we simply add: 
</p>
<pre class="code">RSYSLOGD_OPTIONS=&quot;-r&quot;</pre>

<p>

And on the server which should use the log server in /etc/rsyslog.conf (/etc/syslog.conf) we add: 
</p>
<ul>
<li class="level1"><div class="li">.*           @IP</div>
</li>
</ul>

<p>
where IP is the IP of the logserver.
</p>

</div>

<h2><a name="further_software" id="further_software">Further Software</a></h2>
<div class="level2">

</div>

<h3><a name="ganglia" id="ganglia">Ganglia</a></h3>
<div class="level3">

</div>

<h3><a name="rgang" id="rgang">Rgang</a></h3>
<div class="level3">

<p>
For parallel ssh we use rgang
</p>
<pre class="code">apt-get install rgang</pre>

</div>

<h2><a name="install_new_node" id="install_new_node">Install new Node</a></h2>
<div class="level2">

<p>
These tasks have to be done:
</p>
<ul>
<li class="level1"><div class="li"> add to /etc/dhcp3/dhcpd.conf in dhcp</div>
</li>
<li class="level1"><div class="li"> modify /etc/apt/sources.list</div>
</li>
</ul>

<p>
   deb <a href="http://mirror/debian/" class="urlextern" title="http://mirror/debian/"  rel="nofollow">http://mirror/debian/</a> lenny main contrib non-free
</p>
<pre class="code"> deb-src http://mirror/debian/ lenny main contrib non-free
 deb http://mirror/security.debian.org/ lenny/updates main contrib
 deb-src http://mirror/security.debian.org/ lenny/updates main contrib
 deb http://mirror/debian-multimedia.org lenny main
 deb-src http://mirror/debian-multimedia.org lenny main
* also add corvix.eu!!!
*  apt-get update ; apt-get upgrade
*  apt-get -y install ssh  # and authorized_keys (add key from head)
* apt-get -y install nis-client   # domain cluster
* apt-get -y install nfs-common
* update /etc/fstab
 nas1:/mnt/vol1 /mnt/nas1 nfs defaults,auto,exec 0 0
 nas2:/mnt/vol1 /mnt/nas2 nfs defaults,auto,exec 0 0
 nas3:/mnt/vol1 /mnt/nas3 nfs defaults,auto,exec 0 0
 nas4:/mnt/vol1 /mnt/nas4 nfs defaults,auto,exec 0 0
 nas5:/mnt/vol1 /mnt/nas5 nfs defaults,auto,exec 0 0
* for i in $(seq 1 5); do mkdir /mnt/nas$i; mount /mnt/nas$i; done;</pre>

<p>

NFS Problem: module cannot be loaded, as the architecture of the guest != host ⇒ install new kernel on guest ⇒ update mirror for all architectures

</p>
<ul>
<li class="level1"><div class="li"> apt-get -y install rsync</div>
</li>
</ul>

<p>

installation of the queue - SIMPLIFY THIS <strong>*

  * copy queue files: scp -r /usr/src/cluster r2n16:/usr/src
  * on client compile: torque <code>&#039;TODO</code>&#039; Das muss noch in ein meta-package: wie in var/deb-package/cluster_raw_old/nodes beschrieben
   ./configure –enable-monitor –enable-clients –enable-syslog
   make -j 16 install
  * on client install also maui: <code>&#039;TODO</code>&#039; Das muss noch in ein meta-package: wie in var/deb-package/cluster_raw_old/nodes beschrieben
    export MAUIADMIN=root
    ./configure –with-spooldir=/var/spool/torque –with-pbs=/usr/local–with-key=666
    make -j 16
    make install
  * overcopy maui, cuz of key authentification issues (is compiled in once in head server), so on headserver do:
    rsync -avP /usr/local/maui/. r2n16:/usr/local/maui/.
  * initscripts scp r1n1:/etc/init.d/queue-client /etc/init.d 
  * put node in /var/spool/torque/maui.cfg ⇒ and assign it to a partition
  * <code>&#039;TODO</code>&#039; generalize the cl-refresh script, so that also !=4 cpu nodes are detected

opt-stuff  </strong>* SIMPLIFY THIS
</p>
<ul>
<li class="level1"><div class="li"> call the  var/deb-package/cluster_raw_old/nodes opt script</div>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> add /scratch and chmod it for everybody</div>
</li>
<li class="level1"><div class="li"> add the /etc/hosts file from head <code>&#039;TODO</code>&#039;: automate it</div>
</li>
</ul>

</div>

<h2><a name="booting_the_cluster" id="booting_the_cluster">Booting the cluster</a></h2>
<div class="level2">
<pre class="code">xm create /home/xen/domains/dhcp/config.cfg
echo waiting for dhcp
sleep 120
xm create /home/xen/domains/nis/config.cfg
echo waiting for nis
sleep 100
xm create /home/xen/domains/admin/config.cfg
xm create /home/xen/domains/mirror/config.cfg
xm create /home/xen/domains/boot/config.cfg
xm create /home/xen/domains/queue/config.cfg
xm create /home/xen/domains/mail/config.cfg
echo waiting for overhead servers
sleep 100
for i in $(seq 1 4); do
xm create /home/xen/domains/login$i/config.cfg
done
echo waiting for login nodes
sleep 200
for i in $(seq 1 4); do
for j in $(seq 1 5); do
ssh admin &quot;ssh login$i mount /mnt/nas$j&quot;
done
done</pre>

</div>

<h1><a name="corvix_live" id="corvix_live">Corvix live</a></h1>
<div class="level1">

<p>
<a href="/~wiki/doku.php?id=corvix_live" class="wikilink1" title="corvix_live">Corvix live</a>
</p>

</div>

<h1><a name="legal_stuff" id="legal_stuff">Legal Stuff</a></h1>
<div class="level1">

<p>
Of course we reject any kind of warranty. Expect your hardware to explode and all your data to be deleted.
For the software snipplet, which are halfway included we have put the license stuff under /doc/licenses. All software will be downloaded during the build process and you are responsible on your own not to hurt any lawyers. 
</p>

<p>
(C)opyleft G. Ziegenhain, Y. Rosandi 2008-2009
</p>

<p>
Released under GPLv3 gnu.org
</p>

</div>

    <!-- wikipage stop -->
  </div>

  <div class="clearer">&nbsp;</div>

  
  <div class="stylefoot">

    <div class="meta">
      <div class="user">
              </div>
      <div class="doc">
        corvix.txt &middot; Last modified: 2010/08/25 15:11 by corvix      </div>
    </div>

   
    <div class="bar" id="bar__bottom">
      <div class="bar-left" id="bar__bottomleft">
        <form class="button btn_source" method="post" action="/~wiki/doku.php"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="corvix" /><input type="submit" value="Show pagesource" class="button" accesskey="v" title="Show pagesource [V]" /></div></form>        <form class="button btn_revs" method="get" action="/~wiki/doku.php"><div class="no"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="corvix" /><input type="submit" value="Old revisions" class="button" accesskey="o" title="Old revisions [O]" /></div></form>              </div>
      <div class="bar-right" id="bar__bottomright">
                                        <form class="button btn_login" method="get" action="/~wiki/doku.php"><div class="no"><input type="hidden" name="do" value="login" /><input type="hidden" name="sectok" value="8f61c54f24998367db402acb2b1d9685" /><input type="hidden" name="id" value="corvix" /><input type="submit" value="Login" class="button" title="Login" /></div></form>        <form class="button btn_index" method="get" action="/~wiki/doku.php"><div class="no"><input type="hidden" name="do" value="index" /><input type="hidden" name="id" value="corvix" /><input type="submit" value="Index" class="button" accesskey="x" title="Index [X]" /></div></form>        <a class="nolink" href="#dokuwiki__top"><input type="button" class="button" value="Back to top" onclick="window.scrollTo(0, 0)" title="Back to top" /></a>&nbsp;
      </div>
      <div class="clearer"></div>
    </div>

  </div>

  <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license:<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license" class="urlextern">CC Attribution-Noncommercial-Share Alike 3.0 Unported</a></div>
</div>

<div class="footerinc">

  <a  href="/~wiki/feed.php" title="Recent changes RSS feed"><img src="/~wiki/lib/tpl/default/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" /></a>

        <a  href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license" title="CC Attribution-Noncommercial-Share Alike 3.0 Unported"><img src="/~wiki/lib/images/license/button/cc-by-nc-sa.png" width="80" height="15" alt="" /></a>
  
  <a  href="http://www.dokuwiki.org/donate" title="Donate"><img src="/~wiki/lib/tpl/default/images/button-donate.gif" alt="Donate" width="80" height="15" /></a>

  <a  href="http://www.php.net" title="Powered by PHP"><img src="/~wiki/lib/tpl/default/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>

  <a  href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="/~wiki/lib/tpl/default/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" /></a>

  <a  href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS"><img src="/~wiki/lib/tpl/default/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>

  <a  href="http://dokuwiki.org/" title="Driven by DokuWiki"><img src="/~wiki/lib/tpl/default/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>



</div>

<div class="no"><img src="/~wiki/lib/exe/indexer.php?id=corvix&amp;1376815285" width="1" height="1" alt=""  /></div>
</body>
</html>
